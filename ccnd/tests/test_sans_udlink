AFTER : test_single_ccnd test_twohop_ccnd_teardown
BEFORE : test_single_ccnd_teardown
# Uses the ability to inject an interst message to get two ccnds to
# talk to each other.
# Uses ipv4 localhost to connect to the preloaded ccnd
uname -s | grep SunOS && SkipTest canned sockaddr will not work on Solaris
WithCCND 5 ccnd &
test $CCN_LOCAL_PORT -eq $((0x2328)) || SkipTest FIXME
ccn_xmltoccnb -w - > inject.ccnb <<EOF
<?xml version="1.0"?>
<Inject>
  <SOType>2</SOType>
  <Address ccnbencoding="hexBinary">10 02 2328 7F000001 0000000000000000</Address>
  <Interest>
    <Name>
      <Component ccnbencoding="text">test</Component>
    </Name>
  </Interest>
</Inject>
EOF
WithCCND 5 ccnslurp /test > before_inject.out || SkipTest FIXME
WithCCND 5 smoketestccnd -t 55 recv send inject.ccnb recv
WithCCND 5 ccnslurp /test > after_inject.out
ExpectLines before_inject.out 0 0 : Not expecting content in isolated ccnd
ExpectLines after_inject.out 30 1000 : content in connected ccnd
rm before_inject.out after_inject.out inject.ccnb
WithCCND 5 smoketestccnd -t 55 kill recv
