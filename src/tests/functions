# Functions for supporting the test_* scripts

BEFORE () {
  : Used by testdriver for determining test order
}

AFTER () {
  : Used by testdriver for determining test order
}

Fail () {
  echo "***" Failing $TESTNAME - $*
  exit 1
}

SkipTest () {
  echo "***" Skipping $TESTNAME - $*
  exit 9
}

WithCCND () {
  local port;
  port=$((CCN_LOCAL_PORT_BASE+$1))
  shift
  CCN_LOCAL_PORT=$port "$@"
}

CheckForCCND () {
  WithCCND $1 ccndsmoketest && return 0
  echo "***" ccnd $1 is not ready yet ... >&2
  return 1
}

ExpectLines () {
  local file lines minimum maximum
  lines=`wc -l < $1` || Fail
  file=$1
  minimum=$2
  maximum=$3
  shift 3
  test $lines -ge $minimum || Fail Expecting at least $minimum lines in ${file}, got $lines $*
  test $lines -le $maximum || Fail Expecting at most $maximum lines in ${file}, got $lines $*
  return 0
}

RunTest () {
  ( . settings; . functions; . $1 )
}
