<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.4" />
<title>CCN Interest Message</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
<h1>CCN Interest Message</h1>
</div>
<h2 id="_source_references">Source references</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="../../schema/ccn.xsd">ccn.xsd</a> is the xml schema that describes what the xml rendition of ccn data (including Interest messages) should look like.</p></div>
<div class="paragraph"><p><a href="../../schema/ccn.dtd">ccn.dtd</a> is a dtd that should describe the same, in a less strongly-typed fashion.</p></div>
<div class="paragraph"><p><a href="../../schema/tagname.csvdict">tagname.csvdict</a> contains the mapping between the DTAG values used in the binary encoding and the element names used in the XML representation.</p></div>
<div class="paragraph"><p>Below we will use a less formal abstract syntax to indicate how the pieces fit together.</p></div>
</div>
<h2 id="_interest">Interest</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Interest ::= Name  NameComponentCount?
                   AdditionalNameComponents?
                   PublisherID?
                   Exclude?  OrderPreference?  AnswerOriginKind?  Scope?  Count?  Nonce?</tt></pre>
</div></div>
<div class="paragraph"><p>The hierarchical <strong>Name</strong> is the only required element in an Interest message.
<strong>NameComponentCount</strong> is a special modifier to the interpretation of the Name.
The remaining elements fall into several categories:
1. those that further qualify the ContentObjects that may match the Interest <strong>AdditionalNameComponents</strong>, <strong>PublisherID</strong>, <strong>Exclude</strong>, <strong>ExperimentalResponseFilter</strong>)
2. those that limit where the answer might come from (<strong>AnswerOriginKind</strong>, <strong>Scope</strong>)
3. those that advise the selection of what to send when there are multiple ContentObjects that match (<strong>OrderPreference</strong>)
4. special (<strong>Count</strong>, <strong>Nonce</strong>)</p></div>
</div>
<h2 id="_name">Name</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Name ::= Component*
Component ::= BLOB</tt></pre>
</div></div>
<div class="paragraph"><p>A Name element simply contains a sequence of Component elements. Each Component element contains a sequence of zero or more bytes.  There are no restrictions on what byte sequences may be used, so when displayed as xml, a base64Binary encoding may be needed.  When the bytes happen to be printable UTF-8, a more human-friendly "text" alternative is available (although this is not shown in the official schema).</p></div>
<div class="paragraph"><p>Here is an example of an Interest containing a name with 2 components (&lt;code&gt;ccn:/PARC/%00%01%02&lt;/code&gt;):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>&lt;Interest&gt;
  &lt;Name&gt;
    &lt;Component ccnbencoding="base64Binary"&gt;UEFSQw==&lt;/Component&gt;
    &lt;Component ccnbencoding="base64Binary"&gt;AAEC&lt;/Component&gt;
  &lt;/Name&gt;
&lt;/Interest&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>or, equivalently,</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>&lt;Interest&gt;
  &lt;Name&gt;
    &lt;Component ccnbencoding="text"&gt;PARC&lt;/Component&gt;
    &lt;Component ccnbencoding="base64Binary"&gt;AAEC&lt;/Component&gt;
  &lt;/Name&gt;
&lt;/Interest&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>The binary encoding for this would appear in hexdump form as</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>00000000  01 d2 f2 fa a5 50 41 52  43 00 fa 9d 00 01 02 00  |.....PARC.......|
00000010  00 00                                             |..|</tt></pre>
</div></div>
<div class="paragraph"><p>We won&#8217;t dwell on the details of the binary encoding here, but keep in mind that this is the form that actually appears on the wire.</p></div>
<div class="paragraph"><p>The Name of every piece of content includes as its final component the SHA-256 hash of the Content (just the content bytes themselves, no metadata).  This may occur in an Interest Name as an ordinary Component (the last).  However, this final component is never included explicitly in the ContentObject as it appears on the wire.</p></div>
</div>
<h2 id="_namecomponentcount">NameComponentCount</h2>
<div class="sectionbody">
<div class="paragraph"><p>&lt;verbatim&gt;NameComponentCount ::= nonNegativeInteger&lt;/verbatim&gt;</p></div>
<div class="paragraph"><p>For the (implicit) temporal/accessional/arrival ordering requests to make any sense, there must be a way for the consuming endpoint to indicate where it was in its enumeration.  To do this, we can use the notion of a "marked" name, with the components before the mark indicating the prefix, and the remainder identifying the content that the consumer would like to use as a reference point in the ordering.  (This may also be useful for the name hierarchy order case in some circumstances.)  The wire encoding of this is to have a count of how many leading components constitute the prefix.</p></div>
</div>
<h2 id="_additionalnamecomponents">AdditionalNameComponents</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>AdditionalNameComponents ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p>A client may need to say that the Name in the interest is either the full name including the digest, or the full name except for the digest.  The encoding is a parameter named !AdditionalNameComponents, which gives the exact number of additional name components (counting the explicit digest) that the response should have in addition to the Interest&#8217;s prefix. !AdditionalNameComponents is an optional element.</p></div>
</div>
<h2 id="_publisherid">PublisherID</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>PublisherID ::= BLOB</tt></pre>
</div></div>
<div class="paragraph"><p>If the PublisherID element is present in the Interest, the associated value (a SHA-256 digest) must be equal to the value of the PublisherKeyID of the ContentObject for there to be a match.</p></div>
</div>
<h2 id="_exclude">Exclude</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Exclude ::= Bloom? ( Component Bloom? )*
Bloom ::= BLOB</tt></pre>
</div></div>
<div class="paragraph"><p>The Exclude element embodies a description of name components that should not appear as a continuation of the Name prefix in the response to the interest.
The Components in the exclusion list must occur in strictly increasing order according to the <a href="CanonicalOrder.html">canonical CCN ordering</a>.  Call the pieces in the exclude list B[0], C[1], B[1], C[2], B[2], &#8230; C[m], B[m].  (Here the B[i] are the Bloom elements and the C[i] are the Component elements.  The omission of a Bloom element is equivalent to a bloom filter that describes the empty set.) Furthermore, take C[0] as negative infinity and C[m+1] as infinity. Then a component C is a member of the exclusion set iff C = C[k] for some k in [1..m] or if C[k] &lt; C &lt; C[k+1] for some k in [0..m].</p></div>
<div class="paragraph"><p>A client could choose to simply enumerate the elements of the exclusion set if that is sufficiently compact (using no Bloom filters at all).  At the other extreme, it could simply supply a single Bloom filter to describe the exclusion set.</p></div>
<div class="paragraph"><p>A seed value is used for the hash functions of the bloom filters.  By using different seeds on different expressions of its interests, an application may minimize the impact of the false positives inherent with bloom filters.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Bloom ::= BLOB</tt></pre>
</div></div>
<div class="paragraph"><p>The Bloom&#8217;s BLOB is of length 8 + ceiling(n/8) bytes, where n is the number of bits in the bloom filter.  We restrict n to be a power of two or zero.  The first 8 bytes of the BLOB contains a header:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>    unsigned char lg_bits;  /* 13 maximum (8 kilobits), 3 minimum (one byte) */
    unsigned char n_hash;   /* number of hash functions to employ */
    unsigned char method;   /* allow for various hashing algorithms */
    unsigned char reserved; /* must be 0 for now */
    unsigned char seed[4];  /* can seed hashes differently */</tt></pre>
</div></div>
<div class="paragraph"><p>and the remaining bytes hold the bits of the bloom filter.  The bits in the filter itself are packed little-endian by byte.  Note that a Bloom filter with 0 hash functions is a fine way to match everything, as is a filter with all ones.  <strong>TODO - The the calculation of the hash functions must also be specified.  At present, referring to the c code is the best option; it should be quite easy to port to other languages.</strong></p></div>
</div>
<h2 id="_orderpreference">OrderPreference</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>OrderPreference ::= nonNegativeInteger</tt></pre>
</div></div>
</div>
<h2 id="_answeroriginkind">AnswerOriginKind</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>AnswerOriginKind ::= nonNegativeInteger</tt></pre>
</div></div>
</div>
<h2 id="_scope">Scope</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Scope ::= nonNegativeInteger</tt></pre>
</div></div>
</div>
<h2 id="_count">Count</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Count ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p>This is intended to represent multiple copies of the interest, but for now it is accepted as syntactically valid and ignored.</p></div>
</div>
<h2 id="_nonce">Nonce</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>Nonce ::= BLOB</tt></pre>
</div></div>
</div>
<h2 id="_experimentalresponsefilter">ExperimentalResponseFilter</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>ExperimentalResponseFilter ::= BLOB</tt></pre>
</div></div>
</div>
<h2 id="_summary_of_not_so_recent_protocol_changes">Summary of (not-so)recent protocol changes</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>   1.Digest component __Status:__ _ccnd+, clib+_
   1.The elements that were recently added to the Interest schema (!MatchFirstAvailableDescendant, !MatchLastAvailableDescendant, !MatchNextAvailableSibling, !MatchLastAvailableSibling, !MatchEntirePrefix) are removed, their function being replaced by more general mechanics described below.  __Status:__ _done_
   1.New element type Exclude, which may appear in an Interest.  __Status:__ _ccnd+, clib+_
   1. The client may ask that, in case there are multiple matches at a particular content store, that it wants one of the following:
      a. First or last match in the preorder traversal of the name hierarchy.
      a. First or last match in temporal  order, where this really means arrival order at the node in question.
      a. Unspecified order - whatever the answering node chooses. These are encoded by a nonNegativeInteger in an element named !OrderPreference.
         * The low-order bit of this number indicates the direction:
            * 0 = lesser, earlier, work from the left
            * 1 = greater, later, work from the right
         * add to this one of
            * 0 = whatever answering node chooses- client doesn't care (default if !OrderPreference is omitted)  __Status:__ _ccnd+, clib+_
            * 2 = temporal/accessional/arrival order  __Status:__ _ccnd-_
            * 4 = name hierarchy order  __Status:__ _ccnd+, clib+_
   1. There will be a do-not-answer-from-content-store bit, which also implies a passive bit.  There will eventually need to be some security aspects to this, limiting it by scope and/or by interest signing, but we are choosing to ignore these for now. [There may also be utility in the passive bit alone - it means do not generate any newly-signed content in response to this interest.]  __Status:__ _ccnd+, clib+_&lt;br/&gt;Wire representation: the !AnswerOriginKind element holds a nonNegativeInteger with bitmasks having the following interpretation:
      * 1 = Answer from existing content store
      * 2 = Answers may be generated
      * 4 = Answer may be "stale"
      * 16 = Mark as stale in content store (must have Scope 0) __Status:__ _hack_
      * The default is 3, giving normal behavior.  The two low-order bits in combination mean:
         * 0 = do-not-answer-from-content-store
         * 1 = passive
         * 2 is scary and so won't be allowed
         * 3 = normal
   1. We will want to be able to explore a particular content store using its accession numbers explicitly, but this seems doable without introducing new protocol features by using appropriate naming conventions.  [This will probably not be implemented right away.]
   1. Add an explicit Count field to interests, representing multiple copies of the interest - in particular to (mostly) close the race condition in connection with the do-not-answer-from-content-store bit.  We will need discuss how this should be processed in the general case.  __Status:__ _accepted but ignored_
   1. !NameComponentCount.  __Status:__ _ccnd+, clib+_
   1. !AdditionalNameComponents.  __Status:__ _ccnd+, clib+_
   1. TODO - document the !ExperimentalResponseFilter details.  This is just a Bloom filter that hashes the entire ccnb-encoded Signature of the answer.  It also should be renamed.  It is, however, implemented.</tt></pre>
</div></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2009-07-15 13:40:22 PDT
</div>
</div>
</body>
</html>
